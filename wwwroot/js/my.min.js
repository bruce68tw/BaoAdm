function Datatable(t,e,n,i,o,r){this.dt=null,this.findJson=i,this.recordsFiltered=-1,this.defaultShowOk=!0,this._keepStart=!1,this._start=0,this._nowShowOk=this.defaultShowOk,this.resetCount=function(){this.recordsFiltered=-1},this.find=function(t){this.findJson=t,this.resetCount(),this.dt.search("").draw(!this._keepStart)},this.reload=function(){this._keepStart=!0,this._nowShowOk=!1,this.find(this.findJson)},this.init=function(o,t,e,n,r){var t={processing:!1,serverSide:!0,jQueryUI:!1,filter:!1,paginate:!0,lengthChange:!0,info:!0,sorting:[],pagingType:"full_numbers",language:{url:"/locale/"+_fun.locale+"/dataTables.txt"},dom:_crudR.dtDom,initComplete:function(t,e){r&&$(this).closest(".dataTables_wrapper").find("div.toolbar").html(r);var n,i=$(o+"_filter input");0<i.length&&(i.unbind(),n=this.api(),i.bind("keyup",function(t){13===t.keyCode&&(this.resetCount(),n.search(this.value).draw())}))}.bind(this),ajax:{url:t,type:"POST",dataType:"json",data:function(t){var e=t.order;0<e.length&&((e=e[0]).fid=t.columns[e.column].data),t.findJson=_json.toStr(this.findJson),t.recordsFiltered=this.recordsFiltered,this._keepStart&&(t.start=this._start)}.bind(this),dataSrc:function(t){this._start=this.dt.page.info().start,this._keepStart=!1;var e=_ajax.resultToErrMsg(t);return e?(_tool.msg(e),t.recordsFiltered=0,this.recordsFiltered=0,[]):(this.recordsFiltered=t.recordsFiltered,n?n(t):null===t.data||0===t.data.length?(_tool.alert(_BR.FindNone,"R"),[]):(this._nowShowOk&&_tool.alert(_BR.FindOk),this._nowShowOk=this.defaultShowOk,t.data))}.bind(this),error:function(t,e,n){_tool.hideWait(),_tool.msg("Datatable.js error."),null!=t&&(console.log("status"+t.status),console.log(n))}}},i=(e&&(_var.isEmpty(e.columnDefs)||((i=e.columnDefs)[i.length]=_crudR.dtColDef),t=_json.copy(e,t)),$(o));i.on("preXhr.dt",function(t,e,n){_fun.block()}),i.on("xhr.dt",function(t,e,n){_fun.unBlock()}),this.dt=i.DataTable(t)},this.init(t,e,n,o,r)}function EditMany(_,e,n,i,o){this.init=function(){var t;this.DataFkeyFid="_fkeyfid",this.kid=_,this.hasRowFilter=_str.notEmpty(i),this.rowFilter=i,this.sortFid=o,this.systemError="",this.hasTplRow=_str.notEmpty(n),this.hasTplRow&&(this.tplRow=$("#"+n).html(),t=$(this.tplRow),null==_obj.get(_,t)&&(this.systemError="EditMany.js input kid is wrong ("+_+")",alert(this.systemError)),_edit.setFidTypeVars(this,t),_edit.setFileVars(this,t)),this.hasEform=_str.notEmpty(e),this.hasEform&&(this.eform=$("#"+e),this.rowsBox=this.eform.find("tbody")),this.deletedRows=[],this.newIndex=0},this.isNewRow=function(t){return _edit.isNewKey(t[this.kid])},this.isNewTr=function(t){t=_itext.get(this.kid,t);return _edit.isNewKey(t)},this.reset=function(t){null!=(t=this.getRowsBox(t))&&t.empty(),this.newIndex=0,this.resetDeleted()},this.resetDeleted=function(){this.deletedRows=[]},this.urmLoadJson=function(t,e,n){var i=e.find(":checkbox"),o=(_icheck.setO(i,0),i.data("key",""),_crudE.getRowsByJson(t));if(null!=o)for(var r=0;r<o.length;r++){var s=o[r],a=e.find(_fun.fidFilter(s[n[1]]));_icheck.setO(a,1),a.data("key",s[n[0]])}},this.urmGetUpdJson=function(i,t,o){var e={},r=[],s=this,a=0;return this.resetDeleted(),t.find(":checkbox").each(function(){var t,e=$(this),n=e.data("key");_str.isEmpty(n)?_icheck.checkedO(e)&&((t={})[o[0]]=++a,t[o[1]]=_icheck.getO(e),s.rowSetFkey(t,i),r[r.length]=t):_icheck.checkedO(e)||s.deleteRow(n)}),0<r.length&&(e[_crudE.Rows]=r),e[_crudE.Deletes]=this.getDeletedStr(),e},this.singleFormLoadRow=function(t,e,n){if(this.checkTplRow()){var i=$(Mustache.render(this.tplRow,{Index:n}));_form.loadRow(i,e);for(var o=0;o<this.fidTypeLen;o+=2)fid=this.fidTypes[o],_obj.get(fid,i).data(_edit.DataOld,e[fid]);t.append(i)}},this.loadJson=function(t){var e;this.hasEform?(e=null==t||null==t[_crudE.Rows]?null:t[_crudE.Rows],this.loadRowsByBox(this.rowsBox,e)):this.fnLoadJson(t)},this.loadRowsByBox=function(t,e,n){if(this.checkTplRow()){(_var.isEmpty(n)||n)&&this.reset(t);var i=null==e?0:e.length;if(0!=i)for(var o=0;o<i;o++){for(var r=e[o],s=$(Mustache.render(this.tplRow,r)),a=0;a<this.fidTypeLen;a+=2)fid=this.fidTypes[a],_edit.setOld(_obj.get(fid,s),r[fid]);_idate.init(s),_form.loadRow(s,r),s.appendTo(t)}}},this.valid=function(){return this.hasEform?this.eform.validTable(this.validator):null==this.fnValid||this.fnValid()},this.getKey=function(t){return _input.get(this.kid,t)},this.getRow=function(t){for(var e={},n=0;n<this.fidTypeLen;n+=2)fid=this.fidTypes[n],obj=_obj.get(fid,t),e[fid]=_input.getO(obj,t,this.fidTypes[n+1]);return e},this.checkRowFilter=function(){return!!this.hasRowFilter||(_log.error("EditMany.js this.rowFilter is empty."),!1)},this.checkTplRow=function(){return!!this.hasTplRow||(_log.error("EditMany.js this.tplRow is empty."),!1)},this.elmToRowBox=function(t){return this.checkRowFilter()?$(t).closest(this.rowFilter):null},this.getUpdJsonByCrud=function(t){return this.hasEform?this.getUpdJson(t,this.rowsBox):this.fnGetUpdJson(t)},this.getUpdJson=function(t,e){e=this.getRowsBox(e);var n={};return n[_crudE.Rows]=this.getUpdRows(t,e),n[_crudE.Deletes]=this.getDeletedStr(),n},this.getUpdRows=function(u,t){var f,c;if(this.checkRowFilter())return t=this.getRowsBox(t),this.setSort(t),f=[],t.find((c=this).rowFilter).each(function(t,e){var n,i=$(e),e=_input.get(c.kid,i);if(_edit.isNewKey(e))(n=c.getRow(i))[c.DataFkeyFid]=u,f.push(n);else{for(var o,r,s,a={},l=!1,d=0;d<c.fidTypes.length;d+=2)"read"!==(r=c.fidTypes[d+1])&&(o=c.fidTypes[d],s=_obj.get(o,i),(r=_input.getO(s,i,r))!=_edit.getOld(s))&&(a[o]=r,l=!0);l&&(a[_]=e,f.push(a))}}),0===f.length?null:f},this.getDeletedStr=function(){return 0===this.deletedRows.length?null:this.deletedRows.join()},this.onAddRow=function(){this.addRow()},this.addRow=function(t,e){e=e||{},t=this.getRowsBox(t);t=this._renderRow(t,e);return this.boxSetNewId(t),t},this.onDeleteRow=function(t){t=this.elmToRowBox(t);this.deleteRow(_itext.get(this.kid,t),t)},this.deleteRow=function(t,e){for(var n=this.deletedRows,i=!1,o=n.length,r=0;r<o;r++)if(n[r][this.kid]===t){i=!0;break}i||(n[o]=t),_obj.isExist(e)&&e.remove()},this.onViewFile=function(t,e,n){var i=this.getKey(this.elmToRowBox(n));_edit.viewFile(t,e,n,i)},this._renderRow=function(t,e){if(!this.checkTplRow())return null;t=this.getRowsBox(t);var n=$(Mustache.render(this.tplRow,e));return _form.loadRow(n,e),n.appendTo(t),n},this.dataAddFiles=function(s,a,t){if(!this.hasFile)return null;if(!this.checkRowFilter())return null;t=this.getRowsBox(t);var l=this,d={},u={};return t.find(l.rowFilter).each(function(t,e){for(var n=$(e),i=0;i<l.fileLen;i++){var o=l.fileFids[i],r=_edit.getServerFid(s,o);_ifile.dataAddFile(a,o,r,n)&&(u[o]=null==u[o]?0:u[o]+1,d[r+u[o]]=l.getKey(n))}}),d},this.rowSetFkey=function(t,e){null!=t&&this.isNewRow(t)&&(t[this.DataFkeyFid]=e)},this.rowsSetFkey=function(t,e){if(null!=t)for(var n=0;n<t.length;n++){var i=t[n];null!=i&&this.isNewRow(i)&&(i[this.DataFkeyFid]=e)}},this.boxSetNewId=function(t){return this.newIndex++,_itext.set(this.kid,this.newIndex,t),this.newIndex},this.setSort=function(t){var n,i=this.sortFid;_str.isEmpty(i)||(t=(n=this).getRowsBox(t)).find(_fun.fidFilter(i)).each(function(t,e){_itext.set(i,t,$(e).closest(n.rowFilter))})},this.getRowsBox=function(t){return t||this.rowsBox},this.init()}function EditOne(e,n){this.init=function(){this.kid=e||"Id",n=n||"eform",this.eform=$("#"+n),this.systemError="";var t=1!=this.eform.length?"EditOne.js input eformId is wrong. ("+n+")":null==_obj.get(this.kid,this.eform)?"EditOne.js input kid is wrong. ("+this.kid+")":"";t&&(this.systemError=t,alert(t)),_edit.setFidTypeVars(this,this.eform),_edit.setFileVars(this,this.eform)},this.getKey=function(){return _input.get(this.kid,this.eform)},this.getValue=function(t){return _input.get(t,this.eform)},this.isNewRow=function(){return _str.isEmpty(this.getKey())},this.loadRow=function(t){_form.loadRow(this.eform,t);for(var e=0;e<this.fidTypeLen;e+=2)fid=this.fidTypes[e],_obj.get(fid,this.eform).data(_edit.DataOld,t[fid])},this.getUpdRow=function(){return _edit.getUpdRow(this.kid,this.fidTypes,this.eform)},this.reset=function(){_form.reset(this.eform)},this.setEdit=function(t){_form.setEdit(this.eform,t)},this.dataAddFiles=function(t,e){if(!this.hasFile)return null;for(var n={},i=0;i<this.fileLen;i++){var o=this.fileFids[i],r=_edit.getServerFid(t,o);_ifile.dataAddFile(e,o,r,this.eform)&&(n[r]=this.getKey())}return n},this.onViewFile=function(t,e,n){var i=this.getKey();_edit.viewFile(t,e,n,i)},this.init()}function Flow(o,r,s){this.init=function(){this.StartNode="S",this.EndNode="E",this.NormalNode="N",this.OrSep="{O}",this.AndSep="{A}",this.ColSep=",",this.NodeFilter=".xf-node",this.MenuFilter=".xf-menu",this.EpFilter=".xf-ep",this.StartNodeCls="xf-start-node",this.EndNodeCls="xf-end-node",this.InitLineCfg={stroke:"blue",strokeWidth:2},this.OkLineCfg={stroke:"green",strokeWidth:2},this.DenyLineCfg={stroke:"red",strokeWidth:2},this.StartNodeCfg={filter:this.EpFilter,anchor:["Bottom","Left","Right"],connectorStyle:{stroke:"#5c96bc",strokeWidth:2,outlineStroke:"transparent",outlineWidth:3},connectionType:"basic",extract:{action:"the-action"},maxConnections:10},this.EndNodeCfg={dropOptions:{hoverClass:"dragHover"},anchor:["Top","Bottom","Left","Right"],allowLoopback:!0},this.mNode=r,this.mLine=s,this.divFlowBox=$("#"+o),this.divLinesBox=$("#divLinesBox"),this.divLineConds=$("#divLineConds"),this.eformNode=$("#eformNode"),this.eformLine=$("#eformLine"),this.modalNodeProp=$("#modalNodeProp"),this.modalLineProp=$("#modalLineProp"),this.tplNode=$("#tplNode").html(),this.tplLine=$("#tplLine").html(),this.tplLineCond=$("#tplLineCond").html(),this.nowIsNode=!1,this.nowElm=null;for(var t=[this.OrSep,") || (",this.AndSep," && ",",EQ,","=",",NEQ,","!=",",GT,",">",",GE,",">=",",ST,","<",",SE,","<="],e=(this.condOpExprs=[],this.condOpShows=[],0),n=0;n<t.length;n+=2)this.condOpExprs[e]=new RegExp(t[n],"g"),this.condOpShows[e]=t[n+1],e++;var i=jsPlumb.getInstance({Container:o,Connector:"Flowchart",Endpoint:["Dot",{radius:2}],HoverPaintStyle:{stroke:"#1e8151",strokeWidth:3},ConnectionOverlays:[["Arrow",{location:1,id:"arrow",width:8,length:10,foldback:.8}],["Label",{label:"",id:"label",cssClass:"xf-line-label"}]]});i.registerConnectionType("basic",{anchor:"Continuous",connector:"Flowchart"}),this.plumb=i,this._setFlowEvent()},this._setFlowEvent=function(){var n=this.plumb,i=this;n.bind("contextmenu",function(t,e){i.showPopupMenu(t,e,!1)}),n.bind("beforeDrop",function(t){var e,t=t.connection;return!(0<n.getConnections({source:t.source,target:t.target}).length||(e=i.getLineProp(""),t.setPaintStyle(e.style),i._setLineLabel(t,e.label),e={StartNode:i._elmToNodeValue(t.source,"Id"),EndNode:i._elmToNodeValue(t.target,"Id"),CondStr:"",Sort:9},i._setLineKey(t,i.addLine(e)),0))}),$(document).bind("mousedown",function(t){var e=i.MenuFilter;0<!$(t.target).parents(e).length&&$(e).hide(100)})},this._setNodeEvent=function(e){var t=_itext.get("NodeType",e),n=this.plumb,i=this,o=e[0];n.draggable(o,{grid:[10,10],stop:function(t){t=$(t.el).position();_form.loadRow(e,{PosX:Math.floor(t.left),PosY:Math.floor(t.top)})}}),t!=this.EndNode&&n.makeSource(o,this.StartNodeCfg),t!=this.StartNode&&n.makeTarget(o,this.EndNodeCfg),e.on("contextmenu",function(t){i.showPopupMenu(t.target,t,!0)})},this.loadNodes=function(t){this.reset(),jsPlumb.setSuspendDrawing(!0);for(var e=this.divFlowBox,n=_crudE.getRowsByJson(t),i=0;i<n.length;i++)this._setNodeClass(n[i]);this.mNode.loadRowsByBox(e,n,!1);var o=this;e.find(this.NodeFilter).each(function(){o._setNodeEvent($(this))}),jsPlumb.setSuspendDrawing(!1,!0)},this.loadLines=function(t){jsPlumb.setSuspendDrawing(!0);for(var e=0;e<t.length;e++)this._renderLine(t[e]);this.mLine.loadRowsByBox(this.divLinesBox,t,!1),jsPlumb.setSuspendDrawing(!1,!0)},this._setNodeClass=function(t){switch(t.NodeType){case this.StartNode:t._NodeClass=this.StartNodeCls;break;case this.EndNode:t._NodeClass=this.EndNodeCls}return t},this.addNode=function(t,e){t=this.mNode.addRow(this.divFlowBox,this._setNodeClass({Name:t,NodeType:e,PosX:100,PosY:100}));this._setNodeEvent(t)},this._idToNode=function(t){return this.divFlowBox.find(".xf-node [value="+t+"]").closest(".xf-node")},this._elmToNode=function(t){return $(t).closest(this.NodeFilter)},this._elmToNodeValue=function(t,e){t=this._elmToNode(t);return this._boxGetValue(t,e)},this._boxGetValue=function(t,e){return _itext.get(e,t)},this._boxGetValues=function(t,e){for(var n={},i=0;i<e.length;i++){var o=e[i];n[o]=_itext.get(o,t)}return n},this.deleteNode=function(t){var e=this.plumb,e=(this.deleteLines(e.getConnections({source:t})),this.deleteLines(e.getConnections({target:t})),$(t));this.mNode.deleteRow(this._getObjKey(e)),$(t).remove()},this._renderLine=function(t){var e=this.getLineProp(t.CondStr),n=this.plumb.connect({source:this._idToNode(t.StartNode),target:this._idToNode(t.EndNode),paintStyle:e.style});this._setLineKey(n,t.Id),this._setLineLabel(n,e.label)},this.addLine=function(t){var e=$(this.tplLine),t=(_form.loadRow(e,t),this.mLine.boxSetNewId(e));return this.divLinesBox.append(e),t},this._setLineKey=function(t,e){var n={};n.Id=e,t.setParameters(n)},this._isSourceCondMode=function(t){return t==this.StartNode},this.getLineProp=function(t){return{style:this.InitLineCfg,label:this._condStrToLabel(t)}},this._getLineElmKey=function(t){return t.getParameters().Id},this._getObjKey=function(t){return _itext.get("Id",t)},this._setLineLabel=function(t,e){t=t.getOverlay("label");t.setVisible(_str.notEmpty(e)),t.setLabel(e)},this.deleteLineWithMsg=function(t){_tool.ans("delete this line ?",function(){this.deleteLine(t)})},this.deleteLine=function(t){var e=t.getParameters();this.mLine.deleteRow(e.Id),this.plumb.deleteConnection(t)},this.deleteLines=function(t){for(var e=0;e<t.length;e++)this.deleteLine(t[e])},this.reset=function(){for(var t=this.plumb.getAllConnections(),e=t.length-1;0<=e;e--)this.plumb.deleteConnection(t[e]);this.divFlowBox.find(this.NodeFilter).remove()},this.showPopupMenu=function(t,e,n){e.preventDefault(),this.nowIsNode=n,this.nowElm=n?$(t).closest(this.NodeFilter)[0]:t;n?(this._elmToNodeValue(t,"NodeType"),this.NormalNode):(this._elmToNodeValue(t.source,"NodeType"),this.StartNode);$(this.MenuFilter).finish().toggle(100).css({top:e.pageY+"px",left:e.pageX+"px"})},this._condStrToLabel=function(t){if(_str.isEmpty(t))return"";for(var e=0<t.indexOf(this.OrSep),n=0;n<this.condOpExprs.length;n++)t=t.replace(this.condOpExprs[n],this.condOpShows[n]);return t=e?"("+t+")":t},this._condStrToList=function(t){if(_str.isEmpty(t))return null;for(var e=[],n=0,i=t.split(this.OrSep),o=i.length,r=1<o,s=0;s<o;s++)for(var a=i[s].split(this.AndSep),l=0;l<a.length;l++){var d=a[l].split(this.ColSep);e[n]={AndOr:r?this.OrSep:this.AndSep,Fid:d[0],Op:d[1],Value:d[2]},n++}return e},this._getLineLabel=function(){var n=this,i="";return this.divLineConds.find("tr").each(function(t){var e=$(this),t=(0==t?"":_iselect.get("AndOr",e))+_itext.get("Fid",e)+n.ColSep+_iselect.get("Op",e)+n.ColSep+_itext.get("Value",e);i+=t}),i},this.showNodeProp=function(t){var e=this._elmToNode(this.nowElm),e=this._boxGetValues(e,["NodeType","Name","SignerType","SignerValue"]);_form.loadRow(this.modalNodeProp,e),_modal.showO(this.modalNodeProp)},this.showLineProp=function(t){var e=this.eformLine,n=this._connToLine(t),i=(_iread.set("StartNode",this._elmToNodeValue(t.source,"Name"),e),_iread.set("EndNode",this._elmToNodeValue(t.target,"Name"),e),_itext.set("Sort",this._boxGetValue(n,"Sort"),e),_modal.showO(this.modalLineProp),this.divLineConds.empty(),this._condStrToList(this._boxGetValue(n,"CondStr")));if(null!=i)for(var o=0;o<i.length;o++){var r=$(this.tplLineCond);_form.loadRow(r,i[o]),this.divLineConds.append(r)}},this._connToLine=function(t){return this._idToLine(this._getLineElmKey(t))},this._idToLine=function(t){return this.divLinesBox.find(".xd-line [value="+t+"]").closest(".xd-line")},this.onAddStartNode=function(){0<this.divFlowBox.find("."+this.StartNodeCls).length?_tool.msg("Start Node Already Existed !"):this.addNode("Start",this.StartNode)},this.onAddEndNode=function(){this.addNode("End",this.EndNode)},this.onAddNormalNode=function(){this.addNode("Node",this.NormalNode)},this.onMenuEdit=function(){this.nowIsNode?this.showNodeProp(this._elmToNodeValue(this.nowElm,"NodeType")):this.showLineProp(this.nowElm)},this.onMenuDelete=function(){var t=this;t.nowIsNode?_tool.ans("delete this node ?",function(){t.deleteNode(t.nowElm)}):_tool.ans("delete this line ?",function(){t.deleteLine(t.nowElm)})},this.onAddLineCond=function(){var t={AndOr:this.AndSep,Op:"eq"},e=$(Mustache.render(this.tplLineCond,t));_form.loadRow(e,t),this.divLineConds.append(e)},this.onDeleteLineCond=function(t){$(t).closest("tr").remove()},this.onModalNodeOk=function(){_modal.hideO(this.modalNodeProp);var t=_form.toRow(this.eformNode),e=$(this.nowElm);e.find(".xd-name").text(t.Name),_itext.set("Name",t.Name,e),_itext.set("SignerType",t.SignerType,e),_itext.set("SignerValue",t.SignerValue,e)},this.onModalLineOk=function(){_modal.hideO(this.modalLineProp);var t=this._getLineLabel(),e=this.nowElm,n={CondStr:t,Sort:_itext.get("Sort",this.eformLine)},i=this._connToLine(e),i=(_form.loadRow(i,n),this.getLineProp(t));this._setLineLabel(e,i.label),e.setPaintStyle(i.style)},this.init()}function Page(t){this.pager=t.pager,this.linker=t.linker,this.action=t.action,this.showMenu=t.showMenu||_var.notEmpty(t.pageRowList),this.pageRowList=t.pageRowList||[10,25,50,100],this._init=function(t,e){this.pageArg=this._getPageArg(t);var n,i,o,r,t=this.pageArg,s=this.pager;t.filterRows<=0?(s.hide(),_tool.msg(_BR.FindNone)):(n="",this.showMenu&&(n=(r=_BR.Page.split("@@"))[0].replace("_Menu",this._getMenuHtml()),o=(i=(t.pageNo-1)*t.pageRows+1)+t.pageRows-1,r=r[1].replace("_Start",i).replace("_End",o<=t.filterRows?o:t.filterRows).replace("_Total",t.filterRows),n=_str.format("<div class='xg-page-menu'><label>{0}<span>{1}</span></label></div>",n,r)),s.html(n+"<div class='xg-page-btns'></div>"),s.find("select").change(function(){e()}),s.find(".xg-page-btns").pagination({currentPage:t.pageNo,itemsOnPage:t.pageRows,items:t.filterRows,listStyle:"pagination "+(this.showMenu?"xg-has-menu":"xg-no-menu"),prevText:"<",nextText:">",onPageClick:e}))},this._getMenuHtml=function(){for(var t="<select class='form-select' style='width:80px; display:inline-block'>",e=0;e<this.pageRowList.length;e++)t+=_str.format("<option value='{0}'{1}>{0}</option>",this.pageRowList[e],this.pageArg.pageRows==this.pageRowList[e]?" selected":"");return t+="</select>"},this._getPageArg=function(t){t=JSON.parse(_html.decode(t));return null==t.pageNo&&(t.pageNo=1),null==t.pageRows&&(t.pageRows=0),null==t.filterRows&&(t.filterRows=-1),t},this.find=function(t,e){t=t||{};var n,i=this.pageArg,o=(_var.isEmpty(e)?(i.pageNo=1,i.filterRows=-1,i.pageRows=this.pager.find("select").val()):i.pageNo=e,this.action+"?page="+i.pageNo+"&rows="+i.pageRows+"&filter="+i.filterRows);for(n in t)_str.notEmpty(t[n])&&(o+="&"+n+"="+t[n]);e=this.linker;_obj.isExist(e)?(e.attr("href",o),e.trigger("click")):window.location=o},this._init(t.pageStr,t.onFind)}var _ajax={getJsonA:async function(t,e,n,i){return _ajax._callA({url:t,type:"POST",data:e,dataType:"json"},n)},getJsonByFdA:async function(t,e,n,i){return _ajax._callA({url:t,type:"POST",data:e,dataType:"json",cache:!1,contentType:!1,processData:!1},n,i)},getStrA:async function(t,e,n,i){return _ajax._callA({url:t,type:"POST",data:e,dataType:"text"},n,i)},getViewA:async function(t,e,n,i){return _ajax._callA({url:t,type:"POST",data:e,dataType:"html"},n,i)},getImageFileA:async function(t,e,n){return _ajax._callA({url:t,type:"POST",data:e,dataType:"html"},null,n)},_callA:async function(t,e,n){(n=_var.isEmpty(n)?!0:n)&&_fun.block();var i=!1,o=null;try{_fun.jsonAddJwtHeader(t);var o=await $.ajax(t),r=_ajax.resultToErrMsg(o);(r=r||"string"!=typeof o||o.substring(0,2)!==_fun.PreBrError?r:_ajax.strToErrMsg(o))?(o=null,_tool.msg(r)):e&&(e(o),i=!0)}catch(t){console.error(t)}return n&&_fun.unBlock(),null==e?o:i},resultToErrMsg:function(t){return t.ErrorMsg?_ajax.strToErrMsg(t.ErrorMsg):""},strToErrMsg:function(t){return _str.isEmpty(t)?"":t.substring(0,2)!==_fun.PreBrError?t:(t=t.substring(2),_BR[t]||_str.format("_ajax._callA() failed, no BR Fid={0}",t))}},_array={find:function(t,e){if(null!=t)for(var n=0;n<t.length;n++)if(t[n]==e)return n;return-1},toStr:function(t,e){return t.join(e=e||",")}},_assert={echo:function(t){_error.log("_assert.js "+t)},inArray:function(t,e){var n,i=!1;for(n in e)if(n==t){i=!0;break}i||_assert.echo("inArray failed: "+t)}},_browser={_langCode:"_langCode",pushState:function(t){history.pushState(null,null,t)},zz_print:function(t,e,n){_browser.printO(_obj.getById(t,e,n))},zz_printO:function(t,e){window.print()}},_btn={setEdit:function(t,e,n){_btn.setEditO(_obj.getById(t,n),e)},setEditO:function(t,e){t.prop("disabled",!e)},setEditF:function(t,e,n){_btn.setEditO(_obj.getF(t,n),e)}},_chart={rainbowColors:["#F32E37","#EABE37","#89E926","#22E352","#2FE5E8","#295AE7","#8828EE","#E629B7"],_show:function(t,e,n,i,o){null==o&&(o=!1);t={type:"hbar"==t?"bar":t,data:{labels:n.labels,datasets:n.datasets},options:{plugins:{legend:{position:"bottom",display:i=null==i?!0:i},animation:{animateScale:!0,animateRotate:!0},title:{display:!0,text:n.title}}}};return null!=n.options&&(t.options=_json.copy(n.options,t.options)),o&&(t.options.plugins.tooltip={callbacks:{label:function(t){var e,n=t.dataset.data,n=(null==t.chart._sum&&(e=0,n.map(t=>{e+=t}),t.chart._sum=e),null==t._oldLabel&&(t._oldLabel=t.label+" "+t.formattedValue),(100*n[t.dataIndex]/t.chart._sum).toFixed(2)+"%");return t._oldLabel+" ("+n+")"}}}),new Chart(e,t)},line:function(t,e){return _chart._show("line",t,e,!1)},hbar:function(t,e){return e.options={indexAxis:"y"},_chart._show("hbar",t,e,!1)},pie:function(t,e){return _chart._show("pie",t,e,null,!0)},doughnut:function(t,e){return _chart._show("doughnut",t,e,null,!0)},groupLine:function(t,e){return _chart._show("line",t,e)},groupBar:function(t,e){return _chart._show("bar",t,e)},drawLine:function(t,e,n,i){_chart._clear(),_chart._nowChart=new Chart(document.getElementById(t),{type:"line",data:{labels:e,datasets:[{data:n,borderColor:i,fill:!1}]},options:{plugins:{legend:{display:!1}}}})},initPie:function(t,e,n,i,o){e={type:"pie",options:{legend:{position:"right",labels:{boxWidth:10}}},data:{labels:e,datasets:[{data:n,backgroundColor:i,borderWidth:1}]}};return o&&(e=_json.copy(o,e)),new Chart(t,e)}},_crudE={Rows:"_rows",Childs:"_childs",Deletes:"_deletes",init:function(t){if(_me.divEdit=$("#divEdit"),_me.hasEdit=0<_me.divEdit.length,_me.hasEdit){var e=_crudE.Childs,n=null;if(null==t)n=new EditOne;else if(n=null===t[0]?new EditOne:t[0],1<t.length){n[e]=[];for(var i=1;i<t.length;i++)n[e][i-1]=t[i]}_me.edit0=n,_me.hasChild=_fun.hasValue(_me.edit0[e])&&0<_me.edit0[e].length,_crudE._initForm(_me.edit0)}_me._nowFun="",_me.modal=null},_initForm:function(t){if(null!=t.eform){_idate.init(t.eform),t.validator=_valid.init(t.eform);for(var e=_crudE._getEditChildLen(t),n=0;n<e;n++)_crudE._initForm(_crudE._getEditChild(t,n))}},getEform0:function(){return _me.edit0.eform},_loadJson:function(t){for(var e=_me.edit0,n=(e.loadRow(t),_crudE._getEditChildLen(e)),i=0;i<n;i++)_crudE._getEditChild(e,i).loadJson(_crudE._getChildJson(t,i))},_afterOpenEdit:function(t,e){_fun.hasValue(_me.fnAfterOpenEdit)&&_me.fnAfterOpenEdit(t,e)},_setEditStatus:function(t){var e,n,i;t!==_me._nowFun&&(_me._nowFun=t,n=(e=_me.divEdit).find("input, textarea, select, button"),t==_fun.FunV?(n.prop("disabled",!0),e.find("#btnToRead").prop("disabled",!1),_ihtml.setEdits(e,"",!1)):t==_fun.FunC?(n.prop("disabled",!(i="[data-edit=U]")),n.filter(i).prop("disabled",!0),_ihtml.setEdits(e,"",!0),_ihtml.setEdits(e,i,!1)):t==_fun.FunU&&(n.prop("disabled",!(i="[data-edit=C]")),n.filter(i).prop("disabled",!0),_ihtml.setEdits(e,"",!0),_ihtml.setEdits(e,i,!1)))},_hasFile:function(){var t=_me.edit0;if(t.hasFile)return!0;for(var e=_crudE._getEditChildLen(t),n=0;n<e;n++)if(_crudE._getEditChild(t,n).hasFile)return!0;return!1},_getUpdJson:function(t){for(var e=_me.edit0,n=e.getUpdRow(),i=e.getKey(),o={},r=(e.hasFile&&(o=e.dataAddFiles("0",t)),!1),s=[],a=_crudE._getEditChildLen(e),l=0;l<a;l++){var d=_crudE._getEditChild(e,l),u=(d.hasFile&&(u=d.dataAddFiles("0"+l,t,d.rowsBox),_json.copy(u,o)),d.getUpdJsonByCrud(i));null!=u&&(r=!0,s[l]=u)}var f={},c=!1;return null!=n&&(c=!0,f[_crudE.Rows]=[n]),r&&(c=!0,f[_crudE.Childs]=s),_json.isEmpty(o)||(c=!0,f[_edit.FileJson]=o),c?(_json.removeNull(f),f):null},validAll:function(){var t=_me.edit0;if(_str.notEmpty(t.systemError))return _tool.msg(t.systemError),!1;if(!t.eform.valid())return!1;for(var e=_crudE._getEditChildLen(t),n=0;n<e;n++){var i=_crudE._getEditChild(t,n);if(_str.notEmpty(i.systemError))return _tool.msg(i.systemError),!1;if(!i.valid())return!1}return!0},afterSave:function(t){_fun.hasValue(_me.edit0.fnAfterSave)&&_me.edit0.fnAfterSave(),"0"===t.Value?_tool.msg(_BR.SaveNone):(_tool.alert(_BR.SaveOk+"("+t.Value+")"),_me.hasRead&&(_me.dt.reload(),_crudR.toReadMode()))},_resetForm:function(t){t.reset();for(var e=_crudE._getEditChildLen(t),n=0;n<e;n++)_crudE._getEditChild(t,n).reset()},isEditMode:function(){return _me._nowFun!==_fun.FunV},_updateOrViewA:async function(e,t){var n;return _me.fnUpdateOrViewA?_me.fnUpdateOrViewA(e,t):(n=e==_fun.FunU?"GetUpdJson":"GetViewJson",_ajax.getJsonA(n,{key:t},function(t){_crudE._loadJson(t),_crudE._setEditStatus(e),_crudE._afterOpenEdit(e,t),_crudR.toEditMode(e)}))},_getEditChild:function(t,e){return t[_crudE.Childs][e]},_getEditChildLen:function(t){var e=_crudE.Childs;return null==t[e]?0:t[e].length},getRowsByJson:function(t){return null==t||null==t[_crudE.Rows]?null:t[_crudE.Rows]},_getChildJson:function(t,e){var n=_crudE.Childs;return null==t[n]||t[n].length<=e?null:t[n][e]},getChildRows:function(t,e){t=_crudE._getChildJson(t,e);return _crudE.getRowsByJson(t)},setChildRows:function(t,e,n){var i=_crudE.Childs,t=(null==(t=null==t?{}:t)[i]&&(t[i]=[]),t[i].length<=e&&(t[i][e]={}),t[i][e]);return t[_crudE.Rows]=n,t},onCreate:function(){var t=_fun.FunC;_crudE._setEditStatus(t),_crudE._resetForm(_me.edit0),_crudE._afterOpenEdit(t,null)},onUpdateA:async function(t){return _crudE._updateOrViewA(_fun.FunU,t)},onViewA:async function(t){return _crudE._updateOrViewA(_fun.FunV,t)},onOpenModal:function(t,e,n,i,o){var r=$(t).closest("tr");_tool.showArea(e,_itext.get(n,r),_crudE.isEditMode(),function(t){_itext.set(n,t,r)})},onSaveA:async function(){if(_crudE.validAll()){var t=_me.edit0;if(_fun.hasValue(t.fnWhenSave)){var e=t.fnWhenSave();if(_str.notEmpty(e))return void _tool.msg(e)}var n,i,o,e=new FormData,r=_crudE._getUpdJson(e);_json.isEmpty(r)?_tool.msg(_BR.SaveNone):(i=(n=t.isNewRow())?"Create":"Update",o=null,_crudE._hasFile()?((o=e).append("json",_json.toStr(r)),n||o.append("key",t.getKey()),await _ajax.getJsonByFdA(i,o,function(t){_crudE.afterSave(t)})):(o={json:_json.toStr(r)},n||(o.key=t.getKey()),await _ajax.getJsonA(i,o,function(t){_crudE.afterSave(t)})))}else _tool.alert(_BR.InputWrong)}},_crudR={temp:{},dtDom:'<"toolbar">t<li>p',dtColDef:{className:"xg-center",orderable:!1,targets:"_all"},dtCheck0:function(t,e){_str.isEmpty(t)&&(t=1);t="data-fid='"+_icheck.Check0Id+"' data-value='"+t+"'";return!1===e&&(t+=" readonly"),"<label class='xi-check xg-no-label'>   <input "+t+" type='checkbox'>   <span class='xi-cspan'></span></label>"},dtRadio1:function(t,e){return _iradio.render(_icheck.Check0Id,"",!1,t,e=void 0===e?!0:e)},dtSetStatus:function(t,e,n){return""},dtStatusName:function(t){return"1"==t?"<span>"+_BR.StatusYes+"</span>":'<span class="text-danger">'+_BR.StatusNo+"</span>"},dtYesEmpty:function(t){return"1"==t?_BR.Yes:""},dtCrudFun:function(t,e,n,i,o,r,s,a){var l="";return n&&(l+=_str.format('<button type="button" class="btn btn-link" onclick="{0}(\'{1}\')"><i class="ico-pen" title="{2}"></i></button>',null==r?"_crudR.onUpdateA":r,t,_BR.TipUpdate)),i&&(l+=_str.format('<button type="button" class="btn btn-link" onclick="{0}(\'{1}\',\'{2}\')"><i class="ico-delete" title="{3}"></i></button>',null==s?"_crudR.onDeleteA":s,t,e,_BR.TipDelete)),o&&(l+=_str.format('<button type="button" class="btn btn-link" onclick="{0}(\'{1}\')"><i class="ico-eye" title="{2}"></i></button>',null==a?"_crudR.onViewA":a,t,_BR.TipView)),l},init:function(t,e,n){_me.divRead=$("#divRead"),_me.hasRead=0<_me.divRead.length,_me.hasRead&&(_me.rform=$("#formRead"),0===_me.rform.length&&(_me.rform=null),_me.rform2=$("#formRead2"),0===_me.rform2.length&&(_me.rform2=null),null!=_me.rform&&_idate.init(_me.rform),null!=_me.rform2&&_idate.init(_me.rform2),_var.notEmpty(t))&&(_me.dt=new Datatable("#tableRead","GetPage",t,_crudR._getFindCond())),_me._updName=n,_crudE.init(e),_prog.init()},_getFindCond:function(){var t,e;return null==_me.rform?null:(t=_form.toRow(_me.rform),null!==(e=_me.rform2)&&_obj.isShow(e)&&_json.copy(_form.toRow(e),t),t)},swap:function(t,e,n){var i,o,r;_me.hasRead&&_me.hasEdit?((i=_var.isEmpty(e))&&(e=_me.divEdit),r=t?(o=e,_me.divRead):(o=_me.divRead,e),o.fadeOut(200,function(){r.fadeIn(500),n&&n()}),i&&_crudR._afterSwap(t)):n&&n()},toEditMode:function(t,e){_crudR.swap(!1,null,e),_prog.setPath(t,_me._updName)},toReadMode:function(){_prog.resetPath(),_crudR.swap(!0)},_afterSwap:function(t){_me.fnAfterSwap&&_me.fnAfterSwap(t)},onFind:function(){var t=_crudR._getFindCond();_me.dt.find(t)},onFind2:function(){var t=_me.rform2;null!=t&&(_obj.isShow(t)?_form.hideShow([t]):_form.hideShow(null,[t]))},onResetFind:function(){_form.reset(_me.rform),null!=_me.rform2&&_form.reset(_me.rform2)},onExport:function(){var t=_crudR._getFindCond();window.location="Export?find="+_json.toStr(t)},onToRead:function(){_crudR.toReadMode()},onCreate:function(){_crudE.onCreate(),_crudR.toEditMode(_fun.FunC)},onUpdateA:async function(t){await _crudE.onUpdateA(t)},onViewA:async function(t){await _crudE.onViewA(t)},onSetStatusA:async function(t,e){t=_icheck.checkedO($(t));await _ajax.getStrA("SetStatus",{key:e,status:t},function(t){_tool.alert(_BR.UpdateOk)})},onCheckAll:function(t,e,n){_icheck.setF(_fun.fidFilter(n)+":not(:disabled)",_icheck.checkedO($(t)),e)},onDeleteA:async function(t,e){_tool.ans(_BR.SureDeleteRow+" ("+e+")",async function(){await _ajax.getJsonA("Delete",{key:t},function(t){_tool.alert(_BR.DeleteOk),_me.dt.reload()})})},onDeleteRowsA:async function(t,e){var n=_icheck.getCheckeds(t,e);0===n.length?_tool.msg(_BR.PlsSelectDeleted):_tool.ans(_BR.SureDeleteSelected,async function(){await _ajax.getStrA("DeleteByKeys",{keys:n},function(t){_tool.alert(_BR.DeleteOk),_me.dt.reload()})})}},_date={getStartEnd:function(t,e,n){},nowYear:function(){return(new Date).getFullYear()},mmToUiDate:function(t){return _str.isEmpty(t)?"":moment(t,_fun.MmDateFmt).format(_BR.MmUiDateFmt)},mmToUiDt:function(t){return _str.isEmpty(t)?"":moment(t,_fun.MmDtFmt).format(_BR.MmUiDtFmt)},mmToUiDt2:function(t){return _str.isEmpty(t)?"":moment(t,_fun.MmDtFmt).format(_BR.MmUiDt2Fmt)},mmToFormat:function(t,e){return _str.isEmpty(t)?"":moment(t,_fun.MmDtFmt).format(e)},mmToValue:function(t){return _str.isEmpty(t)?0:moment(t,_fun.MmDtFmt).valueOf()},mmToMoment:function(t){return _str.isEmpty(t)?null:moment(t,_fun.MmDtFmt)},uiToMmDate:function(t){return _str.isEmpty(t)?"":moment(t,_BR.MmUiDateFmt).format(_fun.MmDateFmt)},tsToUiDt:function(t){return""==t?"":moment(1e3*parseInt(t)).format(_BR.MmUiDtFmt)},getHourStr:function(t){},getDt:function(t,e,n){t=_idate.get(t,n),e=_iselect.get(e,n);return""==t?"":""==e?t:t+" "+e},isBig:function(t,e){return moment(t,_fun.MmDtFmt).isAfter(moment(e,_fun.MmDtFmt))},getMonthDiff:function(t,e){return _str.isEmpty(start)||_str.isEmpty(end)?0:_date.getMonthDiffByDate(moment(t,_fun.MmDtFmt),moment(e,_fun.MmDtFmt))},getMonthDiffByDate:function(t,e){return 12*(e.getFullYear()-t.getFullYear())+e.getMonth()-t.getMonth()+1},jsDateAddYear:function(t,e){return moment(t,_fun.MmDtFmt).add(e,"y").format(_fun.MmDtFmt)}},_edit={FileJson:"_fileJson",DataOld:"_old",getOld:function(t){return t.data(_edit.DataOld)},setOld:function(t,e){t.data(_edit.DataOld,e)},getUpdRow:function(t,e,n){var i=_form.toRow(n),o=_input.get(t,n);if(_str.isEmpty(o))return i;for(var r,s,a,l,d=!1,u={},f=0;f<e.length;f+=2)l=_input.getObj(r=e[f],n,s=e[f+1]),(a=i[r])!=(l=l.data(_edit.DataOld))&&("date"!==s&&"dt"!==s||_date.mmToValue(a)!==_date.mmToValue(l))&&(u[r]=a,d=!0);return d?(u[t]=o,u):null},setFidTypeVars:function(t,e){var n=[];e.find(_fun.fidFilter()).each(function(t,e){e=$(e),t*=2;n[t]=_fun.getFid(e),n[1+t]=_input.getType(e)}),t.fidTypes=n,t.fidTypeLen=t.fidTypes.length},setFileVars:function(n,t){n.fileFids=[],t.find("[data-type=file]").each(function(t,e){n.fileFids[t]=_fun.getFid($(e))}),n.fileLen=n.fileFids.length,n.hasFile=0<n.fileFids.length},getServerFid:function(t,e){return"t"+t+"_"+e},dataSetFileJson:function(t,e){var n,i;_json.isEmpty(e)||(n=_edit.FileJson,t.has(n)&&(i=t.get(n),e=_json.copy(e,i)),t.set(n,e))},isNewKey:function(t){var e=(t=t.toString()).length;return!(6<=e||(t=parseInt(t),Number.isNaN(t))||t.toString().length!=e)},viewFile:function(t,e,n,i){var o;_edit.isNewKey(i)?_tool.msg(_BR.NewFileNotView):(o=_file.getFileExt(n.innerText),_file.isImageExt(o)&&_tool.showImage(n.innerHTML,_str.format("ViewFile?table={0}&fid={1}&key={2}&ext={3}",t,e,i,o)))}},_error={log:function(t){console.log(t)}},_file={getFileName:function(t){var e=0<t.indexOf("/")?"/":"\\";return _str.getTail(t,e)},getFileExt:function(t){return _str.getTail(t,".").toLowerCase()},isImageExt:function(t){return 0<=",jpg,jpeg,png,gif,tif,tiff,".indexOf(","+t+",")}},_form={toRow:function(e){var n={};return e.find(_fun.fidFilter()).filter(":not(.xi-unsave)").each(function(){var t=$(this);n[_fun.getFid(t)]=_input.getO(t,e)}),n},toRowStr:function(t){return JSON.stringify(_form.toRow(t))},loadRow:function(t,e){for(var n in e)_input.set(n,e[n],t)},reset:function(t){t.find(_fun.fidFilter()).each(function(){_input.setO($(this),"",t)})},hasFile:function(t){return 0<t.find(":file").length},setEdit:function(t,e){_itext.setEditO(t.find("input:text"),e),_itextarea.setEditO(t.find("textarea"),e),_idate.setEditO(t.find(".date input"),e),_iselect.setEditO(t.find("select"),e),_icheck.setEditO(t.find(":checkbox"),e),_iradio.setEditO(t.find(":radio"),e),_btn.setEditO(t.find("button"),e)},hideShow:function(t,e){if(t)for(var n=0;n<t.length;n++){var i=t[n];i.fadeOut(500,function(){i.hide()})}if(e)for(n=0;n<e.length;n++){var o=e[n];o.fadeIn(500,function(){o.show()})}}},_formData={},_fun={MmDateFmt:"YYYY/MM/DD",MmDtFmt:"YYYY/MM/DD HH:mm:ss",FunC:"C",FunR:"R",FunU:"U",FunD:"D",FunV:"V",PreBrError:"B:",HideRwd:"xg-hide-rwd",locale:"zh-TW",maxFileSize:50971520,isRwd:!1,init:function(t){_fun.locale=t,_leftmenu.init(),_pjax.init(".xu-body"),_tool.init(),moment.locale(_fun.locale)},jsonAddJwtHeader:function(t){_fun.jwtToken&&(t.headers=_fun.getJwtAuth())},getJwtAuth:function(){return{Authorization:_fun.getJwtBearer()}},getJwtBearer:function(){return"Bearer "+_fun.jwtToken},onHelloA:async function(){await _ajax.getStrA("../Fun/Hello",null,function(t){alert(t)})},getFid:function(t){return t.data("fid")},fidFilter:function(t){return _str.isEmpty(t)?"[data-fid]":"[data-fid="+t+"]"},default:function(t,e){return null==t?e:t},hasValue:function(t){return!(null==t)},onSetLocaleA:async function(t){await _ajax.getStrA("../Fun/SetLocale",{code:t},function(t){location.reload()})},block:function(){$.blockUI({message:'<table><tr><td style="height:50px">   <i class="spinner ico-spin"></i>   <span style="margin-left:3px; vertical-align:middle;">'+_BR.Working+"</span></td></tr></table>",css:{padding:"0 30px",borderWidth:"2px",width:"auto",left:"42%"},overlayCSS:{opacity:.3}})},unBlock:function(){$.unblockUI()}},_helper={getBaseProp:function(t,e,n,i,o,r,s){i=_str.format("type='{0}' data-id='{1}' name='{2}' value='{3}'",i,e,e+t,n);return!0===o&&(i+=" required"),!1===r&&(i+=" readonly"),_str.notEmpty(s)&&(i+=" "+s),_str.trim(i)}},_html={encodeRow:function(t,e){for(var n=0;n<e.length;n++){var i=e[n];t[i]=_html.encode(t[i])}return t},encode:function(t){return $("<div/>").text(t).html()},decode:function(t){return $("<div/>").html(t).text()},update:function(t,e){t="#"+t,e=void 0===e?$(t):e.find(t);e.summernote("code",e.text())},updates:function(t,e){for(var n=0;n<t.length;n++)_html.update(t[n],e)}},_ibase={get:function(t,e){return this.getO(_obj.get(t,e))},getF:function(t,e){return this.getO(_obj.getF(t,e))},getD:function(t,e){return this.getO(_obj.getD(t,e))},getO:function(t){return t.val()},getBorder:function(t){return t},set:function(t,e,n){this.setO(_obj.get(t,n),e)},setF:function(t,e,n){this.setO(_obj.getF(t,n),e)},setO:function(t,e){t.val(e)},setEdit:function(t,e,n){this.setEditO(_obj.get(t,n),e)},setEditF:function(t,e,n){this.setEditO(_obj.getF(t,n),e)},setEditO:function(t,e){t.prop("readonly",!e)}},_icheck=$.extend({},_ibase,{Check0Id:"_check0",getO:function(t){return t.is(":checked")?t.data("value"):"0"},setO:function(t,e){t.prop("checked",!(null==e||"0"==e||"False"==e||0==e))},setEditO:function(t,e){t.prop("disabled",!e)},checked:function(t,e){return _icheck.checkedO(_obj.get(t,e))},checkedF:function(t,e){return _icheck.checkedO(_obj.getF(t,e))},checkedO:function(t){return t.is(":checked")},getCheckeds:function(t,e){e=e||_icheck.Check0Id;var n=[];return _obj.getF(_fun.fidFilter(e)+":checked",t).each(function(t){n[t]=$(this).data("value")}),n}}),_icolor={init:function(){$(".xg-color").colorpicker({})},get:function(t,e){return _icolor.getO(_obj.get(t,e))},getF:function(t,e){return _icolor.getO(_obj.getF(t,e))},getO:function(t){return _icolor.rgbToHex(t.find("i").css("background-color"))},rgbToHex:function(t){var e=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete e[0];for(var n=1;n<=3;++n)e[n]=parseInt(e[n]).toString(16),1==e[n].length&&(e[n]="0"+e[n]);return"#"+e.join("")}},_idate=$.extend({},_ibase,{BoxFilter:".date",getO:function(t){return _date.uiToMmDate(t.val())},setO:function(t,e){_idate._boxSetDate(_idate._objToBox(t),_date.mmToUiDate(e))},setEditO:function(t,e){t.prop("disabled",!e)},init:function(t,e){e=_str.isEmpty(e)?t.find(_idate.BoxFilter):_obj.get(e,t).closet(_idate.BoxFilter);0!=e.length&&(e.datepicker({language:_fun.locale,autoclose:!0,showOnFocus:!1}).on("changeDate",function(t){}),e.find(".input-group-addon").off("click"))},onToggle:function(t){_idate._elmToBox(t).datepicker("show")},onReset:function(t){t=_idate._elmToBox(t);_idate.getEditO(_idate._boxGetInput(t))&&_idate._boxSetDate(t,"")},getEditO:function(t){return!t.is(":disabled")},_elmToBox:function(t){return _idate._objToBox($(t))},_objToBox:function(t){return t.closest(_idate.BoxFilter)},_boxSetDate:function(t,e){t.datepicker("update",e)},_boxGetInput:function(t){return t.find("input")}}),_idt=$.extend({},_idate,{getO:function(t){var e=_idate.getO(_idt._boxGetDate(t));return _str.isEmpty(e)?"":e+" "+_iselect.getO(_idt._boxGetHour(t))+":"+_iselect.getO(_idt._boxGetMin(t))},setO:function(t,e){var n,i,e=_str.isEmpty(e)?(n="",i=0):(n=e,i=parseInt(_str.getMid(e," ",":")),parseInt(_str.getMid(e,":",":")));_idate.setO(_idt._boxGetDate(t),n),_iselect.setO(_idt._boxGetHour(t),i),_iselect.setO(_idt._boxGetMin(t),e)},setEditO:function(t,e){_idate.setEditO(_idt._boxGetDate(t),e),_iselect.setEditO(_idt._boxGetHour(t),e),_iselect.setEditO(_idt._boxGetMin(t),e)},_boxGetDate:function(t){return t.find("input:first")},_boxGetHour:function(t){return t.find("select:first")},_boxGetMin:function(t){return t.find("select:last")}}),_ifile=$.extend({},_ibase,{getBorder:function(t){return t.prev()},setO:function(t,e){t.val(e),_ifile._elmToLink(t).text(e)},dataAddFile:function(t,e,n,i){e=_obj.get(e,i),i=_ifile.getUploadFile(_ifile._elmToFile(e)),e=null!=i;return e&&t.append(n,i),e},onOpenFile:function(t){_ifile._elmToFile(t).focus().trigger("click")},onChangeFile:function(t){var e=_ifile._elmToObj(t),n=$(t),i=t.value;if(_str.isEmpty(i))_ifile.setO(e,"");else{var o=n.data("exts").toLowerCase();if(_str.notEmpty(o)&&"*"!==o){var r=_file.getFileExt(i);if((o=","+o+",").indexOf(","+r+",")<0)return _tool.msg(_BR.UploadFileNotMatch),void(t.value="")}o=n.data("max");t.files[0].size>1024*o*1024?(_tool.msg(_str.format(_BR.UploadFileNotBig,o)),t.value=""):_ifile.setO(e,_file.getFileName(i))}},onDeleteFile:function(t){_ifile.setO(_ifile._elmToObj(t),"")},zz_init:function(t,e,n){_obj.get(t,n).val("")},_elmToBox:function(t){return $(t).closest(".xi-box")},_elmToFile:function(t){return _ifile._boxGetFile(_ifile._elmToBox(t))},_elmToObj:function(t){return _ifile._boxGetObj(_ifile._elmToBox(t))},_elmToLink:function(t){return _ifile._boxGetLink(_ifile._elmToBox(t))},_boxGetLink:function(t){return t.find("button").last()},_boxGetFile:function(t){return t.find(":file")},_boxGetObj:function(t){return t.find("[data-type=file]")},getUploadFile:function(t){return 0!=t.length&&0<(t=t.get(0).files).length?t[0]:null}}),_ihtml=$.extend({},_ibase,{Filter:"[data-type=html]",getO:function(t){return t.summernote("code")},setO:function(t,e){t.summernote("code",e)},setEditO:function(t,e){t.summernote(e?"enable":"disable")},init:function(i,e,n){i.eform.find(_ihtml.Filter).each(function(){var t=$(this);t.data("prog",e),t.summernote({height:n||200,callbacks:{onChange:function(t,e){var n=$(this);n.summernote("isEmpty")?(n.val(""),""!=n.summernote("code")&&n.summernote("code","")):n.val(t),i.validator.element(n)},onImageUpload:function(t){var n=$(this),e=new FormData;e.append("file",t[0]),$.ajax({data:e,type:"POST",url:"SetHtmlImage",cache:!1,contentType:!1,processData:!1,success:function(t){var e=document.createElement("img");e.src=t,n.summernote("insertNode",e)}})}}})})},setEdits:function(t,e,n){t=t.find(_ihtml.Filter+e);0<t.length&&t.summernote(n?"enable":"disable")}}),_ilink={get:function(t,e){return this.getO(_obj.get(t,e))},getO:function(t){return t.text()},set:function(t,e,n){this.setO(_obj.get(t,n),e)},setO:function(t,e){t.text(e)}},_input={get:function(t,e){return _input.getO(_obj.get(t,e),e)},getO:function(t,e,n){switch(n=n||_input.getType(t)){case"text":return _itext.getO(t);case"textarea":return _itextarea.getO(t);case"check":return _icheck.getO(t);case"radio":return _iradio.getO(t,e);case"select":return _iselect.getO(t);case"date":return _idate.getO(t);case"dt":return _idt.getO(t);case"file":return _ifile.getO(t);case"html":return _ihtml.getO(t);case"read":return _iread.getO(t);case"link":return _ilink.getO(t);default:return t.val()}},set:function(t,e,n){_input.setO(_obj.get(t,n),e,n)},setO:function(t,e,n,i){if(null!=t&&_var.isPureData(e))switch(i=i||_input.getType(t)){case"text":_itext.setO(t,e);break;case"check":_icheck.setO(t,e);break;case"radio":_iradio.setO(t,e=e||"0",n);break;case"select":_iselect.setO(t,e);break;case"date":return _idate.setO(t,e);case"dt":return _idt.setO(t,e);case"file":_ifile.setO(t,e);break;case"textarea":_itextarea.setO(t,e);break;case"html":_ihtml.setO(t,e);break;case"read":var o=t.data("format");_str.notEmpty(o)&&_str.notEmpty(_BR[o])&&(e=_date.mmToFormat(e,_BR[o])),_iread.setO(t,e);break;case"link":return _ilink.setO(t,e);default:t.val(e)}},getType:function(t){return t.data("type")},getObj:function(t,e,n){return"radio"===(n=n||_input.getType(_obj.get(t,e)))?_iradio.getObj(t,e):_obj.get(t,e)}},_iradio=$.extend({},_ibase,{get:function(t,e){return _iradio._getByName(t,e)},getO:function(t,e){return _iradio._getByName(_obj.getName(t),e)},getObj:function(t,e){return _obj.getF("[name="+t+"]:checked",e)},_getByName:function(t,e){return _iradio.getObj(t,e).data("value")},set:function(t,e,n){_iradio._setByName(t,e,n)},setO:function(t,e,n){_iradio._setByName(_obj.getName(t),e,n)},_setByName:function(t,e,n){t=_obj.getF("[name="+t+"][data-value="+e+"]",n);null!=t&&t.prop("checked",!0)},setEdit:function(t,e,n){_iradio.setEditOs(_obj.get(t,n))},setEditOs:function(t,e){t.attr("disabled",!e)},render:function(t,e,n,i,o,r,s){return r=r||"",s=s||"",""==(e=e||"")&&(e="&nbsp;"),s+=" data-id='"+t+"' name='"+t+"' value='"+(i=_str.isEmpty(i=i||"")?1:i)+"'",n&&(s+=" checked"),void 0===o||o||(s+=" disabled"),_str.format("<label class='xi-check {0}'>   <input type='radio'{1}>{2}   <span class='xi-rspan'></span></label>",r,s,e)}}),_iread={get:function(t,e){return _iread.getO(_obj.get(t,e))},getF:function(t,e){return _iread.getO(_obj.getF(t,e))},getO:function(t){return t.text()},set:function(t,e,n){_iread.setO(_obj.get(t,n),e)},setF:function(t,e,n){_iread.setO(_obj.getF(t,n),e)},setO:function(t,e){t.text(e)}},_iselect=$.extend({},_ibase,{getO:function(t){return 0===t.length?"":t.find("option:selected").val()},setO:function(t,e){filter='option[value="'+e+'"]';e=t.find(filter);return 0<e.length?(e.prop("selected",!0),e):(t.find("option:selected").prop("selected",!1),null)},setEditO:function(t,e){t.prop("disabled",!e)},getIndex:function(t,e){return _iselect.getIndexO(_obj.get(t,e))},getIndexO:function(t){return t.prop("selectedIndex")},getCount:function(t,e){return _iselect.getCountO(_obj.get(t,e))},getCountO:function(t){return t.find("option").length},setIndex:function(t,e,n){_iselect.setIndexO(_obj.get(t,n),e)},setIndexO:function(t,e){t.find("option").eq(e).prop("selected",!0)},getText:function(t,e){t=_obj.get(t,e);return _iselect.getTextO(t)},getTextO:function(t){return t.find("option:selected").text()},getData:function(t,e,n){return _obj.get(t,n).find("option:selected").data(e)},getDataO:function(t,e){return t.find("option:selected").data(e)},setItems:function(t,e,n){t=_obj.get(t,n);_iselect.setItemsO(t,e)},setItemsF:function(t,e,n){t=_obj.getF(t,n);_iselect.setItemsO(t,e)},setItemsO:function(t,e){if(t.find("option").remove(),null!==e)for(var n=0;n<e.length;n++)t.append($("<option></option>").attr("value",e[n].Id).text(e[n].Str))},getExts:function(t,e){var n=[];return _obj.get(t,e).find("option").each(function(t){var e=$(this);n[t]={Id:e.val(),Str:e.text(),Ext:e.data("ext")}}),n},setExts:function(t,e,n){var t="#"+t,i=n?n.find(t):$(t);if(i.find("option").remove(),null!=e)for(var o=0;o<e.length;o++)i.append(_str.format("<option data-ext='{0}' value='{1}'>{2}</option>",e[o].Ext,e[o].Id,e[o].Str))},valuesToJson:function(t,e,n){for(var i=0;i<e.length;i++)t[e[i]]=_iselect.get(e[i],n);return t},filterByExt:function(t,e,n,i,o,r){void 0===o&&(o=!1);for(var s=_obj.get(t,i),a=(s.empty(),""!=r&&s.append(_str.format('<option value="">{0}</option>',r)),n.length),l=0;l<a;l++){var d=n[l];(!0===o&&""==d.Ext||d.Ext==e)&&s.append(_str.format('<option value="{0}">{1}</option>',d.Id,d.Str))}0<a&&_iselect.setIndexO(s,0)}}),_itext=$.extend({},_ibase,{mask:function(t){_obj.getF("[data-mask!='']",t).each(function(){var t=$(this);t.mask(t.data("mask"))})}}),_itextarea=$.extend({},_ibase,{}),_json={copy:function(t,e){var n,e=e||{};for(n in t)e[n]=t[n];return e},keyValuesToJson:function(t,e,n){if(null===t||0===t.length)return null;e=e||"Key",n=n||"Value";for(var i={},o=0;o<t.length;o++){var r=t[o];i["f"+r[e]]=r[n]}return i},toStr:function(t){return _json.isEmpty(t)?"":JSON.stringify(t)},isEmpty:function(t){return null==t||$.isEmptyObject(t)},isKeyValue:function(t){return"[object Object]"===Object.prototype.toString.call(t)},urlToJson:function(t){var t=(t=-1<t.indexOf("?")?t.split("?")[1]:t).split("&"),e={};return t.forEach(function(t){""!==(t=t.split("="))[0]&&(e[t[0]]=decodeURIComponent(t[1]||""))}),e},strToArray:function(t){return $.parseJSON(t)},findIndex:function(t,e,n){if(null!=t)for(var i=0;i<t.length;i++)if(t[i][e]==n)return i;return-1},filterRows:function(t,e,n){return null==t||0==t.length?null:t.filter(function(t){return t[e]===n})},appendRows:function(t,e){if(null!=t&&0!=t.length)for(var n=e.length,i=0;i<t.length;i++)e[n+i]=t[i]},removeNull:function(r,s){s=s||0,$.each(r,function(t,e){if(null===e)delete r[t];else if(_json.isKeyValue(e))_json.removeNull(e,s+1);else if($.isArray(e)){var n=e.length;if(0==n)delete r[t];else{if(_json.isKeyValue(e[0])){$.each(e,function(t,e){_json.removeNull(e,s+1),_json.isEmpty(e)});for(i=!0,o=n-1;0<=o;o--)_json.isEmpty(e[o])?i?delete e[o]:e[o]=null:i=!1}else for(var i=!0,o=0;o<n;o++)if(_str.notEmpty(e[o])){i=!1;break}i&&delete r[t]}}}),_json.isEmpty(r)&&(r=null)}},_leftmenu={init:function(){_leftmenu.menu=$(".xg-leftmenu"),$(".xg-toggle").click(function(t){t.preventDefault();var t=$(this),t=(t.next().collapse("toggle"),t.find(".xg-arrow")),e="xg-open";t.hasClass(e)?t.removeClass(e):t.addClass(e)})},onToggleMenu:function(){_leftmenu.menu.toggleClass("xg-close")}},_locale={},_log={_start:0,_now:0,info:function(t){console.log(t)},error:function(t){alert(t)},logTimeInit:function(t){_start=new Date,_now=_start,t&&console.log(t)},logTime:function(t){var e=new Date,t=t+":"+(e-_now)+"/"+(e-_start);console.log(t),_now=new Date}},_modal={show:function(t){$("#"+t).modal("show")},hide:function(t){$("#"+t).modal("hide")},showO:function(t){t.modal("show")},hideO:function(t){t.modal("hide")},showF:function(t){$(t).modal("show")},hideF:function(t){$(t).modal("hide")}},_nav={moveLeft:function(t){t.insertBefore(t.prev())},moveRight:function(t){t.insertAfter(t.next())}},_num={isBigZero:function(t,e){return!isNaN(t)&&!(!(e||"0"!==t&&0!==t)||parseInt(t)<0)},isNum:function(t){return!isNaN(t)},toBool:function(t){return 1===t},rowToBool:function(t,e){for(var n=0;n<e.length;n++){var i=e[n];t[i]=_num.toBool(t[i])}return t},addComma:function(t){x=(t+="").split("."),x1=x[0],x2=1<x.length?"."+x[1]:"";for(var e=/(\d+)(\d{3})/;e.test(x1);)x1=x1.replace(e,"$1,$2");return x1+x2}},_obj={get:function(t,e){return _obj.getF(_fun.fidFilter(t),e)},getF:function(t,e){e=e.find(t);return 0==e.length?null:e},getN:function(t,e){return _obj.getF("[name="+t+"]",e)},getV:function(t,e){return _obj.getF("[value="+t+"]",e)},getById:function(t,e){return _obj.getF("#"+t,e)},getId:function(t){return 0<t.length?t.attr("id"):""},getName:function(t){return 0<t.length?t.attr("name"):""},isShow:function(t){return t.is(":visible")},isExist:function(t){return null!=t&&0<t.length},hasAttr:function(t){return t.attr(attr)}},_pjax={init:function(t){var e=$(document);e.pjax("[data-pjax]",t,{type:"POST"}),e.on("pjax:success",function(t,e,n,i,o){var e=_str.toJson(e);null!=e&&(e=_ajax.resultToErrMsg(e))&&$(o.container).html(e)}),e.on("pjax:error",function(t,e,n,i,o){return o.success(e.responseText,n,e),!1})}},_prog={me:null,oriPath:"",init:function(){_prog.me=$(".xg-prog-path"),_prog.oriPath=_prog.me.text()},resetPath:function(){_prog.me.text(_prog.oriPath)},setPath:function(t,e){t=t==_fun.FunC?_BR.Create:t==_fun.FunV?_BR.View:t!=_fun.FunU?"??":_str.isEmpty(e)?_BR.Update:e;_prog.setFunName(t)},setFunName:function(t){_prog.me.text(_prog.oriPath+"-"+t)}},_qrcode={set:function(t,e,n,i){return _qrcode.setO(_obj.getById(t,e),n,i)},setO:function(t,e,n){return n=n||128,new QRCode(t[0],{text:e,width:n,height:n,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})}},_str={colSep:"@@",isEmpty:function(t){return null==t||""===t},notEmpty:function(t){return!_str.isEmpty(t)},emptyToStr:function(t,e){return _str.isEmpty(t)?e:t},format:function(){for(var t=arguments[0],e=0;e<arguments.length-1;e++)var n=new RegExp("\\{"+e+"\\}","gm"),t=t.replace(n,arguments[e+1]);return t},getMid:function(t,e,n){var i;return _str.isEmpty(t)?"":(i=t.indexOf(e))<0?t:(n=t.indexOf(n,i+1))<0?t.substring(i+e.length):t.substring(i+e.length,n)},getTail:function(t,e){e=t.lastIndexOf(e);return 0<e?t.substring(e+1):t},toBool:function(t){return"1"==t||1==t||"True"==t},colsToStr:function(){for(var t=arguments[0],e=1;e<arguments.length;e++)t+=_str.colSep+arguments[e];return t},trim:function(t){return $.trim(t)},toJson:function(t){try{return JSON.parse(t)}catch(t){return null}}},_switch={getText:function(t,e,n,i,o,r,s){r=r?' id="'+r+'"':"";i&&(r+=" checked");return _str.format('<label class="switch{5}" style="width:{2}px;"><input{3} class="switch-input{4}" type="checkbox" /><span class="switch-label" data-on="{0}" data-off="{1}"></span><span class="switch-handle"></span></label>',t,e,n,r,s=s?" "+s:"",o?" xg-inline":"")}},_tab={moveLeft:function(t){t.insertBefore(t.prev())},moveRight:function(t){t.insertAfter(t.next())}},_table={rowMoveUp:function(t){t=$(t).closest("tr");t.insertBefore(t.prev())},rowMoveDown:function(t){t=$(t).closest("tr");t.insertAfter(t.next())},getRowCount:function(t,e){return t.find(_fun.fidFilter(e)).length}},_temp={},_time={sleepA:async function(e){return new Promise(t=>setTimeout(t,e))}},_tool={init:function(){_tool.xgAlert=$("#xgAlert"),_tool.xgMsg=$("#xgMsg"),_tool.xgAns=$("#xgAns"),_tool.xgArea=$("#xgArea"),_tool.xgImage=$("#xgImage")},msg:function(t,e){var n=_tool.xgMsg;n.find(".xd-msg").html(t),_modal.showO(n),_tool._fnOnMsgClose=e},ans:function(t,e,n){var i=_tool.xgAns;i.find(".xd-msg").html(t),_modal.showO(i),_tool._fnOnAnsYes=e,_tool._fnOnAnsNo=void 0===n?null:n},alert:function(t,e){var n=_tool.xgAlert;n.find(".xd-msg").text(t),n.fadeIn(500,function(){n.show(),setTimeout(function(){_tool.onAlertClose()},5e3)})},showWait:function(){$("#xgWait").show()},hideWait:function(){$("#xgWait").hide()},showArea:function(t,e,n,i){var o=_tool.xgArea,t=(o.find(".modal-title").text(t),o.find("textarea"));t.val(e),_itextarea.setEditO(t,n),_btn.setEditO(o.find(".xd-yes"),n),n&&(_tool._fnOnAreaYes=i),_modal.showO(o)},onAreaYes:function(){var t=_tool.xgArea;_tool._fnOnAreaYes&&(_modal.hideO(t),t=t.find("textarea").val(),_tool._fnOnAreaYes(t))},showImage:function(t,e){var n=_tool.xgImage;n.find("img").attr("src",e),n.find("label").text(t),_modal.showO(n)},onAlertClose:function(){var t=_tool.xgAlert;t.fadeOut(500,function(){t.hide()})},onAnsYes:function(){_tool._fnOnAnsYes&&(_modal.hideO(_tool.xgAns),_tool._fnOnAnsYes())},onAnsNo:function(){_tool._fnOnAnsNo&&_tool._fnOnAnsNo(),_modal.hideO(_tool.xgAns)},onMsgClose:function(){_tool._fnOnMsgClose&&_tool._fnOnMsgClose(),_modal.hideO(_tool.xgMsg)}},_valid={init:function(t){return t.removeData("validator"),t.validate({ignore:":hidden:not(.xd-valid), .note-editable.panel-body",errorElement:"span",errorPlacement:function(t,e){return t.insertAfter(_valid._getBox($(e))),!1},highlight:function(t,e,n){t=$(t),_valid._getBox(t).removeClass(n).addClass(e),n=_valid._getError(t);return null!=n&&n.show(),!1},unhighlight:function(t,e,n){t=$(t),_valid._getBox(t).removeClass(e).addClass(n),e=_valid._getError(t);return null!=e&&e.hide(),!1}})},_getBox:function(t){return t.closest(".xi-box")},_getError:function(t){t=_valid._getBox(t).next();return 1==t.length&&t.hasClass("error")&&t.is("span")?t:null}},_var={emptyToValue:function(t,e){return _str.isEmpty(t)?e:t},isEmpty:function(t){return null==t},notEmpty:function(t){return!_var.isEmpty(t)},isPureData:function(t){return"object"!=typeof t&&!Array.isArray(t)}},_xp={};